<!DOCTYPE html>
<html>

<head>
    <title>Dynamic Survey Builder</title>
</head>

<body onload="generateSurvey()">

    <center>
        <h1>Customer Feedback Survey</h1>
        <p>Please fill out the form below. Fields marked with * are mandatory.</p>

        <form id="surveyForm" onsubmit="return validateSurvey()">
            <div id="surveyContainer" style="text-align: left; width: 60%; border: 1px solid black; padding: 20px;">

            </div>

            <br>
            <button type="submit">Submit Survey</button>
        </form>
    </center>

    <script>

        var questions = [
            {
                id: "q_name",
                type: "text",
                label: "Full Name",
                required: true,
                maxLength: 30,
                errorMsg: "Name is required and must be under 30 chars."
            },
            {
                id: "q_email",
                type: "email",
                label: "Email Address",
                required: true,
                errorMsg: "Please enter a valid email."
            },
            {
                id: "q_age",
                type: "radio",
                label: "Age Group",
                options: ["Under 18", "18-25", "26-40", "40+"],
                required: true,
                errorMsg: "Please select an age group."
            },
            {
                id: "q_feedback",
                type: "textarea",
                label: "Your Feedback",
                required: false,
                maxLength: 100,
                description: "Max 100 characters."
            },
            {
                id: "q_interests",
                type: "checkbox",
                label: "Which products are you interested in? (Select at least 2)",
                options: ["Laptops", "Mobiles", "Accessories", "Tablets"],
                minSelect: 2,
                errorMsg: "Please select at least 2 options."
            }
        ];


        function generateSurvey() {
            var container = document.getElementById("surveyContainer");

            for (var i = 0; i < questions.length; i++) {
                var q = questions[i];


                var div = document.createElement("div");
                div.style.marginBottom = "15px";


                var label = document.createElement("label");
                label.innerHTML = "<b>" + (i + 1) + ". " + q.label + "</b>" + (q.required ? " <span style='color:red'>*</span>" : "");
                div.appendChild(label);
                div.appendChild(document.createElement("br"));


                if (q.type === "text" || q.type === "email") {
                    var input = document.createElement("input");
                    input.type = q.type;
                    input.name = q.id;
                    input.id = q.id;
                    if (q.maxLength) input.maxLength = q.maxLength;
                    div.appendChild(input);

                } else if (q.type === "textarea") {
                    var area = document.createElement("textarea");
                    area.name = q.id;
                    area.id = q.id;
                    if (q.maxLength) area.maxLength = q.maxLength;
                    area.rows = 3;
                    area.cols = 40;
                    div.appendChild(area);
                    if (q.description) {
                        var desc = document.createElement("small");
                        desc.innerHTML = " (" + q.description + ")";
                        div.appendChild(desc);
                    }

                } else if (q.type === "radio") {
                    for (var j = 0; j < q.options.length; j++) {
                        var opt = q.options[j];
                        var rb = document.createElement("input");
                        rb.type = "radio";
                        rb.name = q.id;
                        rb.value = opt;
                        div.appendChild(rb);

                        var l = document.createElement("span");
                        l.innerHTML = " " + opt + "   ";
                        div.appendChild(l);
                    }

                } else if (q.type === "checkbox") {
                    for (var j = 0; j < q.options.length; j++) {
                        var opt = q.options[j];
                        var cb = document.createElement("input");
                        cb.type = "checkbox";
                        cb.name = q.id;
                        cb.value = opt;
                        cb.className = q.id;
                        div.appendChild(cb);

                        var l = document.createElement("span");
                        l.innerHTML = " " + opt + "   ";
                        div.appendChild(l);
                    }
                }


                var err = document.createElement("div");
                err.id = "error_" + q.id;
                err.style.color = "red";
                err.style.fontSize = "small";
                err.style.display = "none";
                div.appendChild(err);

                container.appendChild(div);
            }
        }


        function validateSurvey() {
            var isValid = true;

            for (var i = 0; i < questions.length; i++) {
                var q = questions[i];
                var errorDiv = document.getElementById("error_" + q.id);
                var isQuestionValid = true;

                if (q.type === "text" || q.type === "email" || q.type === "textarea") {
                    var val = document.getElementById(q.id).value.trim();

                    if (q.required && val === "") {
                        isQuestionValid = false;
                        errorDiv.innerHTML = "This field is required.";
                    }
                    if (q.maxLength && val.length > q.maxLength) {
                        isQuestionValid = false;
                        errorDiv.innerHTML = "Exceeds character limit of " + q.maxLength;
                    }

                } else if (q.type === "radio") {
                    if (q.required) {
                        var radios = document.getElementsByName(q.id);
                        var checked = false;
                        for (var k = 0; k < radios.length; k++) {
                            if (radios[k].checked) checked = true;
                        }
                        if (!checked) {
                            isQuestionValid = false;
                            errorDiv.innerHTML = q.errorMsg;
                        }
                    }

                } else if (q.type === "checkbox") {
                    if (q.minSelect) {
                        var checks = document.getElementsByClassName(q.id);
                        var count = 0;
                        for (var k = 0; k < checks.length; k++) {
                            if (checks[k].checked) count++;
                        }
                        if (count < q.minSelect) {
                            isQuestionValid = false;
                            errorDiv.innerHTML = q.errorMsg;
                        }
                    }
                }
                if (!isQuestionValid) {
                    errorDiv.style.display = "block";
                    isValid = false;
                } else {
                    errorDiv.style.display = "none";
                }
            }

            if (isValid) {
                alert("Form Submitted Successfully!");
                return true;
            } else {
                return false;
            }
        }
    </script>
</body>

</html>